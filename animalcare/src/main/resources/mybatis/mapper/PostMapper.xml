<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="usyd.mingyi.animalcare.mapper.PostMapper">
     <insert id="addPost" parameterType="Post" useGeneratedKeys="true" keyProperty="postId" keyColumn="post_id">
         insert into post (post_id,post_user_id,post_content,post_time)
          values (#{postId},#{userId},#{postContent},#{posTime})
     </insert>

    <insert id="addImage">
        insert into image(image_post_id,image_url)values (#{imagePostId},#{imageUrl})
    </insert>

    <select id="getAllPosts" resultMap="postInfo">
        select * from post AS po left join image AS i on po.post_id=i.image_post_id
        left join user As u on po.post_user_id=u.id
        order by po.post_id DESC limit 10
    </select>
    <resultMap id="postInfo" type="Post">
        <result property="postId" column="post_id"/>
        <result property="userId" column="post_user_id"/>
        <result property="love" column="love"/>
        <result property="postContent" column="post_content"/>
        <result property="topic" column="topic"/>
        <result property="posTime" column="post_time"/>
        <result property="tag" column="tag"/>
        <result property="userAvatar" column="user_image_address"/>
        <collection property="imageUrlList" ofType="String">
            <result column="image_url"/>
        </collection>

    </resultMap>

</mapper>